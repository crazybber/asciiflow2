(function() {var g,aa="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(c.get||c.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)},k="undefined"!=typeof window&&window===this?this:"undefined"!=typeof global&&null!=global?global:this;function ba(){ba=function(){};k.Symbol||(k.Symbol=ca)}var da=0;function ca(a){return"jscomp_symbol_"+(a||"")+da++}
function m(){ba();var a=k.Symbol.iterator;a||(a=k.Symbol.iterator=k.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&aa(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return ea(this)}});m=function(){}}function ea(a){var b=0;return fa(function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}})}function fa(a){m();a={next:a};a[k.Symbol.iterator]=function(){return this};return a}function q(a){m();var b=a[Symbol.iterator];return b?b.call(a):ea(a)}
function r(a,b){this.x=a;this.y=b}function t(a,b){var c=a.touches[void 0===b?0:b];return new r(c.pageX,c.pageY)}function u(a,b){return!!b&&a.x==b.x&&a.y==b.y}function v(a,b){return new r(a.x-b.x,a.y-b.y)}g=r.prototype;g.add=function(a){return new r(this.x+a.x,this.y+a.y)};g.clone=function(){return new r(this.x,this.y)};g.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};g.scale=function(a){return new r(this.x*a,this.y*a)};function w(a){return new r(a.x,a.y-1)}
function z(a){return new r(a.x,a.y+1)}function A(a){return new r(a.x-1,a.y)}g.right=function(a){return new r(this.x+(void 0===a?1:a),this.y)};var B=["+","\u2012","\u2013","-","|"],C=[">","<","^","v"],ga=B.concat(C),D="ontouchstart"in window||"onmsgesturechange"in window,E=new r(-1,0),F=new r(1,0),G=new r(0,-1),H=new r(0,1),I=[E,F,G,H];function J(a,b){this.a=Math.min(a.x,b.x);this.b=Math.min(a.y,b.y);this.c=Math.max(a.x,b.x);this.f=Math.max(a.y,b.y)}function ha(a){return new r(a.a,a.b)}J.prototype.contains=function(a){return a.x>=this.a&&a.x<=this.c&&a.y>=this.b&&a.y<=this.f};function ia(){this.a=this.value=null}function K(a){return null!=a.a?a.a:a.value}function L(a){return ga.includes(K(a))}function M(a){return null==a.value&&null==a.a}
function ja(a,b,c,e){this.a=a;this.right=b;this.c=c;this.b=e;this.h=this.f=this.i=this.g=!1}function N(a){return a.a+a.right+a.c+a.b}function ka(a,b){this.position=a;this.value=b}function la(a,b){this.position=a;this.a=b};function ma(a){for(var b=0;b<a.a.length;b++)for(var c=0;c<a.a[b].length;c++)null!=K(a.a[b][c])&&O(a,new r(b,c),"\u2009");P(a)}function Q(a,b){return a.a[b.x][b.y]}function O(a,b,c){var e=Q(a,b);a.b.push(new la(b,e));e.a=c;a.c=!0}function R(a,b,c){K(Q(a,b))!=c&&O(a,b,c)}function S(a){for(var b=q(a.b),c=b.next();!c.done;c=b.next())c.value.a.a=null;a.b.length=0}
function T(a,b){var c=Q(a,b),e=null!=c.a?c.a:c.value,d=B.includes(e),f=C.includes(e);if(!d&&!f)return e;c=U(a,b);if(d&&c.a&&c.right&&!c.c&&!c.b)return"-";if(d&&!c.a&&!c.right&&c.c&&c.b)return"|";if(4==N(c))return"-";if(f&&3==N(c)){if(!c.a)return"<";if(!c.c)return"^";if(!c.b)return"v";if(!c.right)return">"}if((d||f)&&3==N(c)){c.g=L(Q(a,w(A(b))));c.i=L(Q(a,w(b.right())));c.f=L(Q(a,z(A(b))));c.h=L(Q(a,z(b.right())));if(!c.right&&c.g&&c.f||!c.a&&c.i&&c.h)return"|";if(!c.b&&c.g&&c.i||!c.c&&c.h&&c.f)return"-";
e=M(Q(a,w(A(b))));d=M(Q(a,w(b.right())));if(c.c&&c.a&&c.right&&(!e||!d))return"-";e=M(Q(a,z(A(b))));d=M(Q(a,z(b.right())));return!(c.b&&c.a&&c.right)||e&&d?"+":"-"}if(f&&1==N(c)){if(c.a)return">";if(c.c)return"v";if(c.b)return"^";if(c.right)return"<"}return e}function U(a,b){var c=L(Q(a,A(b))),e=L(Q(a,b.right())),d=L(Q(a,w(b))),f=L(Q(a,z(b)));return new ja(c,e,d,f)}
function P(a,b){var c=[],e=a.b.map(function(a){return a.position.x.toString()+a.position.y.toString()}),d=a.b.filter(function(a,c){return e.indexOf(e[c])==c});a.b.length=0;for(var d=q(d),f=d.next();!f.done;f=d.next()){var l=f.value,f=l.position,l=l.a;c.push(new ka(f,null!=l.value?l.value:" "));var h=K(l);if("\u2009"==h||" "==h)h=null;L(l)&&(h=T(a,f));l.a=null;l.value=h}d=b?a.f:a.g;0<c.length&&(50<d.length&&d.shift(),d.push(c));a.c=!0}
function na(a){if(a.g.length){for(var b=a.g.pop(),b=q(b),c=b.next();!c.done;c=b.next())c=c.value,O(a,c.position,c.value);P(a,!0)}}function oa(a){if(a.f.length){for(var b=a.f.pop(),b=q(b),c=b.next();!c.done;c=b.next())c=c.value,O(a,c.position,c.value);P(a)}};function V(a,b,c,e,d){d=void 0===d?"+":d;var f=new J(b,c),l=f.a,h=f.b,n=f.c,f=f.f,x=e?c.x:b.x;for(e=e?b.y:c.y;l++<n;){var p=new r(l,e),y=U(a,new r(l,e));" "==d&&2==y.c+y.b||R(a,p,d)}for(;h++<f;)p=new r(x,h),y=U(a,new r(x,h))," "==d&&2==y.a+y.right||R(a,p,d);O(a,b,d);O(a,c,d);R(a,new r(x,e),d)};function pa(a){this.a=a;this.b=null}g=pa.prototype;g.start=function(a){this.b=a};g.j=function(a){S(this.a);V(this.a,this.b,a,!0);V(this.a,this.b,a,!1)};g.m=function(){P(this.a)};g.o=function(){return"crosshair"};g.l=function(){};function W(a){this.c=a;this.a=this.b=null}g=W.prototype;g.start=function(a){this.b=a;this.j(a)};g.j=function(a){S(this.c);this.a=a;a=Math.min(this.b.y,this.a.y);for(var b=Math.max(this.b.x,this.a.x),c=Math.max(this.b.y,this.a.y),e=Math.min(this.b.x,this.a.x);e<=b;e++)for(var d=a;d<=c;d++)O(this.c,new r(e,d),"\u2009")};g.m=function(){P(this.c)};g.o=function(){return"crosshair"};g.l=function(){};function qa(a,b){this.a=a;this.value=b;D&&(document.getElementById("freeform-tool-input").value="",document.getElementById("freeform-tool-input").style.display="none",setTimeout(function(){document.getElementById("freeform-tool-input").style.display="block";setTimeout(function(){document.getElementById("freeform-tool-input").focus()},0)},0))}g=qa.prototype;g.start=function(a){O(this.a,a,this.value)};g.j=function(a){O(this.a,a,this.value)};g.m=function(){P(this.a)};g.o=function(){return"crosshair"};
g.l=function(a){D&&(this.value=document.getElementById("freeform-tool-input").value.charAt(0),document.getElementById("freeform-tool-input").blur(),document.getElementById("freeform-tool-input").style.display="none");1==a.length&&(this.value=a)};function ra(a,b){this.a=a;this.c=b;this.b=null}g=ra.prototype;g.start=function(a){this.b=a};g.j=function(a){S(this.a);var b=U(this.a,this.b),c=U(this.a,a);V(this.a,this.b,a,b.c&&b.b||c.a&&c.right);this.c&&O(this.a,a,"^")};g.m=function(){P(this.a)};g.o=function(){return"crosshair"};g.l=function(){};function sa(a){this.c=a;this.g=this.f=this.b=this.a=null;this.h=!0;this.i=[]}g=sa.prototype;g.start=function(a){this.a&&this.b&&(new J(this.a,this.b)).contains(a)?(this.f=a,ta(this),ua(this,a)):(this.a=a,this.b=null,this.h=!1,this.j(a))};function ta(a){var b=a.c.b.filter(function(a){return null!=K(a.a)&&"\u2009"!=K(a.a)}),c=ha(new J(a.a,a.b));a.i=b.map(function(a){return new ka(v(a.position,c),K(a.a))})}
g.j=function(a){if(this.f)ua(this,a);else if(1!=this.h){this.b=a;S(this.c);a=new J(this.a,a);for(var b=a.a;b<=a.c;b++)for(var c=a.b;c<=a.f;c++){var e=new r(b,c),d=K(Q(this.c,e));O(this.c,e,null==d?"\u2009":d)}}};function ua(a,b){a.g=b;S(a.c);var c=new W(a.c);c.start(a.a);c.j(a.b);c=v(a.g,a.f).add(ha(new J(a.a,a.b)));va(a,c)}function va(a,b){for(var c=q(a.i),e=c.next();!e.done;e=c.next()){var e=e.value,d=e.value;O(a.c,e.position.add(b),d)}}
g.m=function(){this.f&&(P(this.c),this.b=this.a=null);this.g=this.f=null;this.h=!0};g.o=function(a){return this.a&&this.b&&(new J(this.a,this.b)).contains(a)?"pointer":"default"};g.l=function(a){if(this.a&&this.b&&("<copy>"!=a&&"<cut>"!=a||ta(this),"<cut>"==a)){var b=new W(this.c);b.start(this.a);b.j(this.b);P(this.c)}"<paste>"==a&&(va(this,this.a),P(this.c))};function wa(a){this.b=a;this.c=this.a=null}g=wa.prototype;g.start=function(a){P(this.b);document.getElementById("text-tool-input").value="";this.a=a;a=K(Q(this.b,this.a));O(this.b,this.a,null==a?"\u2009":a)};g.j=function(){};
g.m=function(){null!=this.a&&(this.c=this.a,this.a=null,document.getElementById("text-tool-widget").style.display="none",setTimeout(function(){document.getElementById("text-tool-widget").style.display="block";setTimeout(function(){document.getElementById("text-tool-input").focus()},0)},0))};g.o=function(){return"pointer"};
g.l=function(){var a=document.getElementById("text-tool-input").value;S(this.b);for(var b=this.b,c=this.c,e=0,d=0,a=q(a),f=a.next();!f.done;f=a.next())f=f.value,"\n"==f?(d++,e=0):(O(b,c.add(new r(e,d)),f),e++)};function xa(a){this.a=a;this.b=null;this.c=[]}g=xa.prototype;
g.start=function(a){var b;if(D)if(L(Q(this.a,a)))b=a;else{var c=I.concat([E.add(G),E.add(H),F.add(G),F.add(H)]);b=null;for(var e=0,c=q(c),d=c.next();!d.done;d=c.next()){var d=d.value,f=a.add(d),l=N(U(this.a,f));L(Q(this.a,f))&&l>e&&(b=d,e=l)}b=null==b?a:a.add(b)}else b=a;this.b=b;this.c=[];if(L(Q(this.a,this.b))){U(this.a,this.b);b=[];e=q(I);for(c=e.next();!c.done;c=e.next())for(c=c.value,d=ya(this,this.b,c),d=q(d),f=d.next();!f.done;f=d.next()){var f=f.value,l=0!=c.x,h=-1!=C.indexOf(K(Q(this.a,a))),
n=-1!=C.indexOf(K(Q(this.a,f)));if(1==N(U(this.a,f)))b.push({position:f,s:l,v:h,u:n});else for(var x=q(I),p=x.next();!p.done;p=x.next())p=p.value,0!=c.add(p).length()&&2!=c.add(p).length()&&(p=ya(this,f,p),p.length&&(p=p[0],b.push({position:p,s:l,v:h,w:n,u:-1!=C.indexOf(K(Q(this.a,p)))})))}this.c=b;this.j(this.b)}};
g.j=function(a){S(this.a);for(var b=q(this.c),c=b.next();!c.done;c=b.next()){var e=c.value;V(this.a,this.b,e.position,e.s," ")}for(var d in this.c)V(this.a,a,e.position,e.s);b=q(this.c);for(c=b.next();!c.done;c=b.next())e=c.value,e.v&&O(this.a,a,"^"),e.u&&O(this.a,e.position,"^"),e.w&&O(this.a,new r(e.s?e.position.x:a.x,e.s?a.y:e.position.y),"^")};g.m=function(){P(this.a)};
function ya(a,b,c){for(var e=b.clone(),d=[];;){var f=e.add(c);if(!L(Q(a.a,f)))return u(b,e)||d.push(e),d;e=f;3==N(U(a.a,e))&&d.push(e)}}g.o=function(a){return L(Q(this.a,a))?"pointer":"default"};g.l=function(){};function za(a){a.b.width=document.documentElement.clientWidth;a.b.height=document.documentElement.clientHeight;a.f=!0}function Aa(a){if(a.f||a.g.c)a.f=!1,a.g.c=!1,Ba(a);window.requestAnimationFrame(function(){Aa(a)})}
function Ba(a){var b=a.h;b.setTransform(1,0,0,1,0,0);b.clearRect(0,0,a.b.width,a.b.height);b.scale(a.c,a.c);b.translate(a.b.width/2/a.c,a.b.height/2/a.c);var c=v(X(a,new r(0,0)),new r(3,3)),e=X(a,new r(a.b.width,a.b.height)).add(new r(3,3));c.x=Math.max(0,Math.min(c.x,2E3));e.x=Math.max(0,Math.min(e.x,2E3));c.y=Math.max(0,Math.min(c.y,600));e.y=Math.max(0,Math.min(e.y,600));b.lineWidth="1";b.strokeStyle="#EEEEEE";b.beginPath();for(var d=c.x;d<e.x;d++)b.moveTo(9*d-a.a.x,0-a.a.y),b.lineTo(9*d-a.a.x,
17*a.g.a.length-a.a.y);for(d=c.y;d<e.y;d++)b.moveTo(0-a.a.x,17*d-a.a.y),b.lineTo(9*a.g.a.length-a.a.x,17*d-a.a.y);a.h.stroke();d=!a.i;b.font="15px Courier New";for(var f=c.x;f<e.x;f++)for(var l=c.y;l<e.y;l++){var h=Q(a.g,new r(f,l));if(L(h)||null!=h.a&&" "!=K(h))a.h.fillStyle=null!=h.a?"#DEF":"#F5F5F5",b.fillRect(9*f-a.a.x,17*(l-1)-a.a.y,9,17);var n=T(a.g,new r(f,l));null==n||L(h)&&!d||(a.h.fillStyle="#000000",b.fillText(n,9*f-a.a.x,17*l-a.a.y-3))}if(a.i){b.lineWidth="1";b.strokeStyle="#000000";b.beginPath();
for(d=c.x;d<e.x;d++)for(h=!1,f=c.y;f<e.y;f++)l=Q(a.g,new r(d,f)),L(l)&&f!=e.y-1||!h||(b.moveTo(9*d-a.a.x+4.5,17*h-a.a.y-8.5),b.lineTo(9*d-a.a.x+4.5,17*(f-1)-a.a.y-8.5),h=!1),L(l)&&!h&&(h=f);for(f=c.y;f<e.y;f++)for(h=!1,d=c.x;d<e.x;d++)l=Q(a.g,new r(d,f)),L(l)&&d!=e.x-1||!h||(b.moveTo(9*h-a.a.x+4.5,17*f-a.a.y-8.5),b.lineTo(9*(d-1)-a.a.x+4.5,17*f-a.a.y-8.5),h=!1),L(l)&&!h&&(h=d);a.h.stroke()}}
function X(a,b){var c=new r((b.x-a.b.width/2)/a.c+a.a.x,(b.y-a.b.height/2)/a.c+a.a.y);return new r(Math.min(Math.max(1,Math.round((c.x-4.5)/9)),1998),Math.min(Math.max(1,Math.round((c.y+8.5)/17)),598))};function Y(){Array.prototype.forEach.call(document.getElementsByClassName("dialog"),function(a){return a.classList.remove("visible")})}function Ca(a,b){var c=X(a.a,b);a.f||(a.f=c);u(c,a.f)||(a.a.b.style.cursor=a.c.o(c));2!=a.mode||u(c,a.f)||a.c.j(c);if(1==a.mode){var e=a.a,d=a.h.add(v(a.g,b).scale(1/a.a.c));e.a=d;e.f=!0}a.f=c}function Z(a){2==a.mode&&a.c.m();a.mode=0;a.g=null;a.h=null;a.f=null}
function Da(a){window.addEventListener("resize",function(){za(a.a)});Array.prototype.forEach.call(document.querySelectorAll("#draw-tools > button.tool"),function(b){return b.addEventListener("click",function(c){document.getElementById("text-tool-widget").style.display="none";Ea(a,c.target.id)})});Array.prototype.forEach.call(document.querySelectorAll("#file-tools > button.tool"),function(b){return b.addEventListener("click",function(c){c=c.target.id;Y();document.getElementById(c+"-dialog").classList.toggle("visible");
"import-button"==c&&(document.getElementById("import-area").value="",document.getElementById("import-area").focus());if("export-button"==c){var b=document.getElementById("export-area"),d;d=a.b;for(var f=new r(Number.MAX_VALUE,Number.MAX_VALUE),l=new r(-1,-1),h=0;h<d.a.length;h++)for(var n=0;n<d.a[h].length;n++)null!=K(d.a[h][n])&&(h<f.x&&(f.x=h),n<f.y&&(f.y=n),h>l.x&&(l.x=h),n>l.y&&(l.y=n));if(0>l.x)d="";else{for(var x="",n=f.y;n<=l.y;n++){for(var p="",h=f.x;h<=l.x;h++)var y=T(d,new r(h,n)),p=p+(null==
y||"\u2009"==y?" ":y);x+=p.replace(/\s+$/,"")+"\n"}d=x}b.value=d;document.getElementById("export-area").select()}"clear-button"==c&&ma(a.b);"undo-button"==c&&na(a.b);"redo-button"==c&&oa(a.b)})});Array.prototype.forEach.call(document.querySelectorAll("button.close-dialog-button"),function(a){return a.addEventListener("click",function(){Y()})});document.getElementById("import-submit-button").addEventListener("click",function(){ma(a.b);for(var b=a.b,c=X(a.a,new r(a.a.b.width/2,a.a.b.height/2)),e=document.getElementById("import-area").value.split("\n"),
d=new r(0,Math.round(e.length/2)),f=0;f<e.length;f++)d.x=Math.max(d.x,Math.round(e[f].length/2));for(f=0;f<e.length;f++)for(var l=e[f],h=0;h<l.length;h++){var n=l.charAt(h);B.includes(n)&&(n="+");O(b,v((new r(h,f)).add(c),d),n)}P(a.b);document.getElementById("import-area").value="";Y()});document.getElementById("use-lines-button").addEventListener("click",function(){Y();var b=a.a;b.i=!0;b.f=!0});document.getElementById("use-ascii-button").addEventListener("click",function(){Y();var b=a.a;b.i=!1;b.f=
!0});window.addEventListener("keypress",function(b){b.ctrlKey||b.metaKey||13==b.keyCode||a.c.l(String.fromCharCode(b.keyCode))});window.addEventListener("keydown",function(b){var c=null;if(b.ctrlKey||b.metaKey)67==b.keyCode&&(c="<copy>"),86==b.keyCode&&(c="<paste>"),90==b.keyCode&&na(a.b),89==b.keyCode&&oa(a.b),88==b.keyCode&&(c="<cut>");8==b.keyCode&&(c="<backspace>");13==b.keyCode&&(c="<enter>");38==b.keyCode&&(c="<up>");40==b.keyCode&&(c="<down>");37==b.keyCode&&(c="<left>");39==b.keyCode&&(c=
"<right>");null!=c&&a.c.l(c)});document.getElementById("text-tool-input").addEventListener("keyup",function(){a.c.l("")});document.getElementById("freeform-tool-input").addEventListener("keyup",function(){a.c.l("")});document.getElementById("text-tool-input").addEventListener("change",function(){a.c.l("")});document.getElementById("freeform-tool-input").addEventListener("change",function(){a.c.l("")});document.getElementById("text-tool-close").addEventListener("click",function(){document.getElementById("text-tool-widget").style.display=
"none";P(a.b)})}
function Ea(a,b){Array.prototype.forEach.call(document.querySelectorAll("#draw-tools > button.tool"),function(a){return a.classList.remove("active")});document.getElementById(b).classList.toggle("active");Y();"box-button"==b&&(a.c=new pa(a.b));"line-button"==b&&(a.c=new ra(a.b,!1));"arrow-button"==b&&(a.c=new ra(a.b,!0));"freeform-button"==b&&(a.c=new qa(a.b,"X"));"erase-button"==b&&(a.c=new W(a.b));"move-button"==b&&(a.c=new xa(a.b));"text-button"==b&&(a.c=new wa(a.b));"select-button"==b&&(a.c=new sa(a.b));
P(a.b);a.a.b.focus()};function Fa(a){var b=a.a.a.b;b.addEventListener("mousewheel",function(c){c=a.a.a.c*(0<c.wheelDelta?1.1:.9);c=Math.max(Math.min(c,5),.2);var b=a.a.a;b.c=c;b.f=!0});b.addEventListener("mousedown",function(c){if(c.ctrlKey||c.metaKey){var b=a.a;c=new r(c.clientX,c.clientY);b.mode=1;b.g=c;b.h=b.a.a}else b=a.a,c=new r(c.clientX,c.clientY),b.mode=2,b.c.start(X(b.a,c))});b.addEventListener("mouseup",function(){Z(a.a)});b.addEventListener("mouseleave",function(){Z(a.a)});b.addEventListener("mousemove",function(c){Ca(a.a,
new r(c.clientX,c.clientY))})}function Ga(a,b){a.f=b;a.h=Date.now();a.b=!1;window.setTimeout(function(){if(!a.b&&!a.c&&a.f){var c=a.a;c.mode=2;c.c.start(X(c.a,b))}},150)}
function Ha(a){var b=a.a.a.b;b.addEventListener("touchstart",function(c){c.preventDefault();if(1==c.touches.length)Ga(a,t(c));else if(1<c.touches.length){var b=t(c,0);c=t(c,1);Z(a.a);a.c=!0;a.b=!1;a.i=v(b,c).length();a.g=a.a.a.c}});b.addEventListener("touchmove",function(c){c.preventDefault();if(1==c.touches.length){c=t(c);if(!a.b&&150>Date.now()-a.h&&6<v(c,a.f).length()){a.b=!0;var b=a.a;b.mode=1;b.g=c;b.h=b.a.a}Ca(a.a,c)}else 1<c.touches.length&&a.c&&(c=a.g*v(t(c,0),t(c,1)).length()/a.i,c=Math.max(Math.min(c,
5),.5),b=a.a.a,b.c=c,b.f=!0)});b.addEventListener("touchend",function(b){b.preventDefault();a.b=!1;a.c=!1;a.f=null;Z(a.a)})};var Ia=new function(){this.a=Array(2E3);this.b=[];this.c=!0;this.g=[];this.f=[];for(var a=0;a<this.a.length;a++){this.a[a]=Array(600);for(var b=0;b<this.a[a].length;b++)this.a[a][b]=new ia}},Ja=new function(a){this.g=a;this.b=document.getElementById("ascii-canvas");this.h=this.b.getContext("2d");this.c=1;this.a=new r(9E3,5100);this.f=!0;this.i=!1;za(this)}(Ia),Ka=new function(a,b){this.a=a;this.b=b;this.c=new pa(b);this.mode=0;this.f=null;Da(this)}(Ja,Ia);
new function(a){this.a=a;this.c=this.b=!1;Ha(this)}(Ka);new function(a){this.a=a;Fa(this)}(Ka);Aa(Ja);})();
